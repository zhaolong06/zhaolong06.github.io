---
layout: post
title: 微信小程序之组件间通信
date: 2018-01-31
categories: 小程序
tags: 小程序
---

* content
{:toc}

微信小程序从1.6.3版本开始支持自定义组件，在此之前，我们组件的写法通常都是基于template来封装，但这样的做法弊端非常明显，就是组件无法做到内聚，另外组件中的js是通过mixin的方式注入进去的，这就使得在一个页面中无法使用相同的组件超过2次，否则会导致两个组件的状态都是一致的；当然这可以通过命名空间来解决，但路途也是非常坎坷。

自定义组件的创建以及使用不是本文的重点，对于还不了解自定义组件的同学，可以参考微信的官方文档，个人感觉写得还算通俗易懂，链接在此：[https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/)。

在开始写自定义组件之前，建议大家把自定义组件的注意事项通读一遍，不然可能会踩坑，下面列举一下：

* WXML节点标签名只能是小写字母、中划线和下划线的组合，所以自定义组件的标签名也只能包含这些字符
* 自定义组件也是可以引用自定义组件的，引用方法类似于页面引用自定义组件的方式（使用 usingComponents 字段）
* 自定义组件和使用自定义组件的页面所在项目根目录名不能以“wx-”为前缀，否则会报错
* 旧版本的基础库不支持自定义组件，此时，引用自定义组件的节点会变为默认的空节点
* 组件对应 wxss 文件的样式，只对组件wxml内的节点生效
* 组件和引用组件的页面不能使用id选择器（#a）、属性选择器（[a]）和标签名选择器，请改用class选择器
* 组件和引用组件的页面中使用后代选择器（.a .b）在一些极端情况下会有非预期的表现，如遇，请避免使用
* 子元素选择器（.a>.b）只能用于 view 组件与其子节点之间，用于其他组件可能导致非预期的情况
* 继承样式，如 font 、 color ，会从组件外继承到组件内
* 除继承样式外， app.wxss 中的样式、组件所在页面的的样式对自定义组件无效

简单点来说就是，在自定义组件中只能使用class选择器来写样式，使用其它方式虽然也可以，但是会带来非预期的表现（之前在项目中就曾使用标签选择器，结果组件内的样式影响了全局）。另外除了font、color等样式会从组件外继承到组件内之外，其它样式均不会继承，也就是说你在外部定义了一个按钮的样式，在组件内是除了部分属性之外，其余属性是继承不到的。从1.9.90版本开始，组件支持传入外部类，但之前在项目中我的一个同事遇到了一个比较奇葩的问题，他定义了一个modal组件，在一个页面中有好几处引用，该组件可以传入外部类进行样式控制，但只有第一个传进去的组件使用了外部类，第二、三个均没有，由于当时在比赛，该问题没有深究，而是改用了属性的方式来控制。目前我在demo中没有复现这个问题，如果大家有遇到类似的问题，欢迎留言反馈。


### 自定义组件的坑


